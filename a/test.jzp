(mod-load code.jzp)

(entry main ()
  (push test-fibonacci)
  (call)
  (return)
)

(subr test-factorial ()
  (push 4)
  (push factorial)
  (call)
  (push system-ostream)
  (push stream-output)
  (call)
  (return)
)

(subr test-fibonacci ()
  (push 6)
  (push fibonacci)
  (call)
  (push system-ostream)
  (push stream-output)
  (call)
  (return)
)

(subr test-count (x)
  (var tmp)
  (load x)
  (store tmp)
  (label l1)
  (push 1)
  (load tmp)
  (sub)
  (store tmp)
  (load tmp)
  (push 0)
  (eq)
  (not)
  (jmpi l1)
  (return)
)

(subr test-output ()
  (push "hello world!")
  (push system-ostream)
  (push stream-output)
  (call)
  (return)
)
